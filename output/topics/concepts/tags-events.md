# Reference: Platform Events

Platform events are generated by the LimaCharlie cloud infrastructure itself, rather than by endpoint agents. These events capture system-level activities, infrastructure changes, and platform operations.

## Platform Event Types

### Cloud Events
Events generated by cloud infrastructure components and services.

### System Events
Internal platform operations and state changes.

### Infrastructure Events
Changes to infrastructure configuration and status.

## Event Structure

Platform events follow a consistent schema with the following common fields:

- **event_type**: The type of platform event
- **timestamp**: When the event occurred
- **routing**: Event routing information
- **event**: Event-specific payload

## Common Platform Events

### Audit Events
Track administrative actions and configuration changes across the platform.

### Billing Events
Monitor usage and billing-related activities.

### Integration Events
Events from third-party integrations and external services.

### Service Events
Platform service status changes and health monitoring.

## Accessing Platform Events

Platform events are available through:

- REST API queries
- Event streaming
- Detection & Response rules
- Artifact collection

## Event Retention

Platform events follow the same retention policies as endpoint telemetry, based on your subscription tier.

---

# Sysmon Comparison

LimaCharlie provides comprehensive endpoint telemetry that covers and extends beyond Windows Sysmon capabilities.

## Event Coverage Comparison

### Process Events

**Sysmon Event ID 1: Process Creation**
- **LimaCharlie Equivalent**: `NEW_PROCESS`
- **Advantages**: Cross-platform (Windows, Linux, macOS, Chrome), includes parent process chain, network context

**Sysmon Event ID 5: Process Terminated**
- **LimaCharlie Equivalent**: `TERMINATE_PROCESS`
- **Advantages**: Exit codes, resource usage statistics

**Sysmon Event ID 10: Process Access**
- **LimaCharlie Equivalent**: Not directly mapped
- **Note**: LimaCharlie focuses on behavior-based detection rather than low-level access events

### File Events

**Sysmon Event ID 11: File Created**
- **LimaCharlie Equivalent**: `NEW_DOCUMENT`, `FILE_CREATE`
- **Advantages**: Cross-platform, content hashing, automatic threat intelligence lookups

**Sysmon Event ID 23: File Deleted**
- **LimaCharlie Equivalent**: `FILE_DELETE`
- **Advantages**: Tracks deletion context and actor

**Sysmon Event ID 26: File Delete Logged**
- **LimaCharlie Equivalent**: `FILE_DELETE`

### Network Events

**Sysmon Event ID 3: Network Connection**
- **LimaCharlie Equivalent**: `NETWORK_CONNECTIONS`, `NEW_TCP4_CONNECTION`, `NEW_TCP6_CONNECTION`, `NEW_UDP4_CONNECTION`, `NEW_UDP6_CONNECTION`
- **Advantages**: Automatic GeoIP, threat intelligence integration, DNS correlation

**Sysmon Event ID 22: DNS Query**
- **LimaCharlie Equivalent**: `DNS_REQUEST`
- **Advantages**: Query and response correlation, threat intelligence

### Registry Events (Windows)

**Sysmon Event ID 12: Registry Object Added or Deleted**
**Sysmon Event ID 13: Registry Value Set**
**Sysmon Event ID 14: Registry Object Renamed**
- **LimaCharlie Equivalent**: `REGISTRY_CREATE`, `REGISTRY_DELETE`, `REGISTRY_WRITE`
- **Advantages**: Pattern-based collection, reduced noise

### Driver/Image Events

**Sysmon Event ID 6: Driver Loaded**
- **LimaCharlie Equivalent**: `DRIVER_LOAD`

**Sysmon Event ID 7: Image Loaded**
- **LimaCharlie Equivalent**: `MODULE_LOAD`
- **Advantages**: Hash-based tracking, signature verification

### Additional Sysmon Events

**Sysmon Event ID 8: CreateRemoteThread**
- **LimaCharlie Equivalent**: `REMOTE_THREAD_INJECTION`
- **Advantages**: Behavior detection, code injection detection

**Sysmon Event ID 15: File Stream Created (ADS)**
- **LimaCharlie Equivalent**: Covered by file monitoring
- **Note**: Alternate data streams tracked automatically

**Sysmon Event ID 17/18: Pipe Events**
- **LimaCharlie Equivalent**: `NAMED_PIPE_CREATE`, `NAMED_PIPE_CONNECT`

**Sysmon Event ID 19/20/21: WMI Events**
- **LimaCharlie Equivalent**: `WMI_QUERY`, `WMI_CREATE`

## LimaCharlie-Exclusive Capabilities

Events and features available in LimaCharlie but not in Sysmon:

### Cross-Platform Coverage
- Linux events (process, file, network)
- macOS events
- Chrome OS events

### Cloud-Native Features
- Automatic threat intelligence enrichment
- Real-time Detection & Response
- Artifact collection
- Memory analysis
- Live investigation commands

### Advanced Telemetry
- `CODE_IDENTITY`: Code signing and identity verification
- `GET_DOCUMENT`: On-demand file retrieval
- `CONNECTED`: Sensor heartbeat and connectivity
- `USER_OBSERVED`: User session tracking
- Service-specific events (SSH, HTTP, etc.)

### Behavioral Detection
- Process relationship tracking
- Automated behavior analysis
- Privilege escalation detection
- Lateral movement detection

## Migration Considerations

When migrating from Sysmon to LimaCharlie:

1. **Event Mapping**: Use the comparison above to map existing Sysmon-based detections
2. **Configuration**: LimaCharlie uses exfil rules and D&R rules instead of Sysmon XML configuration
3. **Performance**: LimaCharlie's cloud-native architecture reduces endpoint performance impact
4. **Flexibility**: D&R rules provide more powerful detection logic than Sysmon event filtering

---

# Event Schemas

LimaCharlie events follow structured schemas that define the fields and data types for each event type.

## Schema Structure

All events share common base fields:

```json
{
  "routing": {
    "oid": "organization_id",
    "sid": "sensor_id",
    "iid": "installer_id",
    "tags": ["tag1", "tag2"],
    "arch": "x64|x86|arm64",
    "plat": "windows|linux|macos|chrome"
  },
  "event_type": "EVENT_TYPE",
  "event_time": 1234567890,
  "event_id": "unique_event_identifier",
  "event": {
    // Event-specific fields
  }
}
```

## Common Field Types

### Routing Information
- **oid**: Organization ID (UUID)
- **sid**: Sensor/Agent ID (UUID)
- **iid**: Installer ID (UUID)
- **tags**: Array of sensor tags
- **arch**: Architecture (x64, x86, arm64)
- **plat**: Platform (windows, linux, macos, chrome)

### Time Fields
- **event_time**: Unix timestamp (seconds since epoch)
- Timestamps use UTC

### Identifiers
- **event_id**: Unique event identifier (UUID)
- **pid**: Process ID
- **ppid**: Parent process ID
- **tid**: Thread ID

### File Information
- **file_path**: Full path to file
- **file_name**: File name only
- **hash**: File hash (usually SHA256)
- **size**: File size in bytes

### Network Information
- **ip**: IP address (IPv4 or IPv6)
- **port**: Port number
- **protocol**: Network protocol
- **domain**: DNS domain name

### Process Information
- **process_path**: Full executable path
- **command_line**: Complete command line
- **user**: Username
- **integrity_level**: Process integrity level (Windows)

## Event-Specific Schemas

### NEW_PROCESS

```json
{
  "event_type": "NEW_PROCESS",
  "event": {
    "PROCESS_ID": 1234,
    "PARENT_PROCESS_ID": 5678,
    "FILE_PATH": "C:\\Windows\\System32\\cmd.exe",
    "COMMAND_LINE": "cmd.exe /c whoami",
    "USER_NAME": "SYSTEM",
    "HASH": "sha256_hash",
    "PARENT": {
      "PROCESS_ID": 5678,
      "FILE_PATH": "C:\\Windows\\System32\\services.exe"
    }
  }
}
```

### NETWORK_CONNECTIONS

```json
{
  "event_type": "NETWORK_CONNECTIONS",
  "event": {
    "PROCESS_ID": 1234,
    "STATE": "ESTABLISHED",
    "IP_ADDRESS": "1.2.3.4",
    "PORT": 443,
    "PROTOCOL": "tcp"
  }
}
```

### DNS_REQUEST

```json
{
  "event_type": "DNS_REQUEST",
  "event": {
    "DOMAIN_NAME": "example.com",
    "MESSAGE_TYPE": "query",
    "PROCESS_ID": 1234
  }
}
```

### FILE_CREATE

```json
{
  "event_type": "FILE_CREATE",
  "event": {
    "FILE_PATH": "C:\\Users\\user\\file.txt",
    "PROCESS_ID": 1234,
    "HASH": "sha256_hash",
    "SIZE": 12345
  }
}
```

## Schema Validation

Event schemas are validated by the LimaCharlie platform. Invalid events are rejected with error codes.

For complete event schema documentation, see the endpoint agent events reference.

---

# Reference: Schedule Events

Schedule events are time-based triggers in the LimaCharlie platform that execute actions on a defined schedule.

## Schedule Event Types

### Periodic Schedules
Execute actions at regular intervals:
- Every N minutes
- Hourly
- Daily
- Weekly
- Monthly

### Cron-Style Schedules
Use cron expressions for complex scheduling patterns.

### One-Time Schedules
Execute once at a specific time.

## Creating Scheduled Events

Scheduled events are configured through:
- REST API
- Web interface
- Infrastructure as Code

## Schedule Configuration

### Required Fields
- **name**: Schedule identifier
- **interval**: Execution frequency
- **action**: Action to execute

### Optional Fields
- **enabled**: Enable/disable schedule
- **timezone**: Timezone for execution (default: UTC)
- **max_executions**: Limit number of executions

## Actions

Scheduled events can trigger:
- Detection & Response rules
- Artifact collection
- External webhooks
- Service requests

## Example Schedule Configurations

### Daily Report
```json
{
  "name": "daily_report",
  "interval": "24h",
  "action": "generate_report",
  "enabled": true
}
```

### Hourly Scan
```json
{
  "name": "hourly_scan",
  "interval": "1h",
  "action": "run_scan",
  "timezone": "America/New_York"
}
```

## Schedule Management

- View active schedules
- Modify schedule parameters
- Enable/disable schedules
- Delete schedules
- View execution history

## Execution Logging

All scheduled executions are logged with:
- Execution timestamp
- Success/failure status
- Action output
- Error messages (if any)

---

# Reference: Error Codes

LimaCharlie error codes and their meanings.

## HTTP Error Codes

Standard HTTP status codes used by the REST API.

### 2xx Success
- **200 OK**: Request succeeded
- **201 Created**: Resource created successfully
- **204 No Content**: Success with no response body

### 4xx Client Errors
- **400 Bad Request**: Invalid request format or parameters
- **401 Unauthorized**: Authentication required or failed
- **403 Forbidden**: Insufficient permissions
- **404 Not Found**: Resource does not exist
- **409 Conflict**: Resource conflict (e.g., duplicate)
- **429 Too Many Requests**: Rate limit exceeded

### 5xx Server Errors
- **500 Internal Server Error**: Unexpected server error
- **503 Service Unavailable**: Service temporarily unavailable

## Platform Error Codes

LimaCharlie-specific error codes.

### Authentication Errors
- **INVALID_API_KEY**: API key is invalid or expired
- **INVALID_JWT**: JWT token is invalid
- **ORG_NOT_FOUND**: Organization does not exist

### Permission Errors
- **INSUFFICIENT_PERMISSIONS**: User lacks required permissions
- **RESOURCE_ACCESS_DENIED**: Access to resource denied

### Resource Errors
- **SENSOR_NOT_FOUND**: Sensor ID does not exist
- **RULE_NOT_FOUND**: Detection rule not found
- **INVALID_RULE_SYNTAX**: D&R rule syntax error

### Data Errors
- **INVALID_EVENT_FORMAT**: Event format validation failed
- **SCHEMA_VALIDATION_FAILED**: Data does not match required schema
- **INVALID_TIMESTAMP**: Timestamp format invalid

### Rate Limiting
- **RATE_LIMIT_EXCEEDED**: API rate limit exceeded
- **QUOTA_EXCEEDED**: Account quota limit reached

### Service Errors
- **SERVICE_UNAVAILABLE**: Service temporarily unavailable
- **TIMEOUT**: Request timeout
- **INTERNAL_ERROR**: Unexpected internal error

## Error Response Format

```json
{
  "error": "ERROR_CODE",
  "message": "Human-readable error description",
  "details": {
    "field": "Additional context"
  }
}
```

## Handling Errors

Best practices for error handling:

1. **Check HTTP status code** first
2. **Parse error response** for details
3. **Implement retry logic** for 5xx errors
4. **Respect rate limits** (429 responses)
5. **Log errors** for debugging

## Common Error Scenarios

### Invalid API Key
```json
{
  "error": "INVALID_API_KEY",
  "message": "The provided API key is not valid"
}
```

### Rate Limit Exceeded
```json
{
  "error": "RATE_LIMIT_EXCEEDED",
  "message": "Rate limit exceeded, retry after 60 seconds",
  "details": {
    "retry_after": 60
  }
}
```

### Rule Syntax Error
```json
{
  "error": "INVALID_RULE_SYNTAX",
  "message": "Detection rule contains syntax errors",
  "details": {
    "line": 5,
    "error": "Unexpected token"
  }
}
```

---

# Events

Events are the core telemetry data collected by LimaCharlie. They represent activities, state changes, and observations from endpoints and the platform.

## Event Categories

### Endpoint Agent Events
Telemetry collected from endpoint sensors:
- Process events
- File system events
- Network events
- Registry events (Windows)
- Authentication events
- System events

### Platform Events
Events generated by LimaCharlie infrastructure:
- Cloud events
- Service events
- Audit events
- Integration events

## Event Flow

1. **Collection**: Events are generated by endpoint agents or platform services
2. **Routing**: Events are routed based on organization, sensor, and tags
3. **Processing**: Events are processed by Detection & Response rules
4. **Storage**: Events are stored according to retention policies
5. **Access**: Events are accessible via REST API, streaming, or web interface

## Event Structure

All events follow a common structure:

- **Routing metadata**: Organization, sensor, tags, platform
- **Event type**: Identifier for the event category
- **Timestamp**: When the event occurred
- **Event payload**: Event-specific data

## Working with Events

### Querying Events
- REST API queries
- Timeline search
- Historical queries
- Real-time streaming

### Filtering Events
- By event type
- By sensor or tags
- By time range
- By custom fields

### Event Retention
Retention periods vary by subscription tier:
- Free tier: 7 days
- Professional: 30 days
- Enterprise: Custom retention

## Event-Driven Actions

Events can trigger automated responses:
- Detection & Response rules
- Artifacts collection
- External webhooks
- Service integrations

## Event Analysis

Tools for analyzing events:
- Timeline visualization
- Search and filtering
- Aggregation and statistics
- Export and reporting

## Performance Considerations

- Events are processed in real-time
- Historical queries may take longer for large datasets
- Use specific filters to improve query performance
- Consider retention policies for long-term storage

## Best Practices

1. **Use appropriate event types** for detection rules
2. **Filter events** to reduce noise
3. **Leverage tags** for event routing
4. **Monitor event volume** for anomalies
5. **Archive important events** before retention expiration

---

# Endpoint Agent Events Overview

Endpoint agents collect telemetry from monitored systems, generating events that capture process execution, file activity, network connections, and system changes.

## Event Categories

### Process Events
Track process lifecycle and execution:
- **NEW_PROCESS**: Process creation with full command line and parent chain
- **TERMINATE_PROCESS**: Process termination with exit code
- **MODULE_LOAD**: DLL/library loading
- **REMOTE_THREAD_INJECTION**: Code injection detection

### File Events
Monitor file system activity:
- **FILE_CREATE**: New file creation
- **FILE_DELETE**: File deletion
- **FILE_MODIFY**: File modification
- **NEW_DOCUMENT**: Document file creation (filtered by extension)
- **GET_DOCUMENT**: File content retrieval

### Network Events
Track network connections and DNS:
- **NETWORK_CONNECTIONS**: Active network connections snapshot
- **NEW_TCP4_CONNECTION**: New IPv4 TCP connection
- **NEW_TCP6_CONNECTION**: New IPv6 TCP connection
- **NEW_UDP4_CONNECTION**: New IPv4 UDP connection
- **NEW_UDP6_CONNECTION**: New IPv6 UDP connection
- **DNS_REQUEST**: DNS query and response

### Registry Events (Windows)
Monitor Windows Registry changes:
- **REGISTRY_CREATE**: Registry key creation
- **REGISTRY_DELETE**: Registry key deletion
- **REGISTRY_WRITE**: Registry value modification

### Authentication Events
Track user authentication and sessions:
- **USER_OBSERVED**: User session detection
- **USER_LOGIN**: User login event
- **USER_LOGOUT**: User logout event

### System Events
System-level events and changes:
- **DRIVER_LOAD**: Kernel driver loading (Windows)
- **SYSTEM_STARTUP**: System boot
- **SYSTEM_SHUTDOWN**: System shutdown
- **CONNECTED**: Sensor heartbeat and connectivity
- **CODE_IDENTITY**: Code signing and verification

### Detection Events
Events generated by detections:
- **DETECTION**: D&R rule match
- **ALERT**: Triggered alert

## Platform-Specific Events

### Windows-Only Events
- Registry events
- Driver loading
- WMI events
- Named pipe events

### Linux-Only Events
- Process credentials
- File permissions
- SELinux events

### macOS-Only Events
- LaunchAgent/LaunchDaemon monitoring
- Kernel extension events

## Event Collection Control

### Exfil Rules
Control which events are sent to the cloud:
- Include/exclude event types
- Filter by process, path, or network
- Reduce event volume
- Focus on relevant telemetry

### Event Sampling
Sample high-volume events to reduce data:
- Network connections
- DNS queries
- File system events

## Event Enrichment

Events are automatically enriched with:
- File hashes (SHA256)
- Code signatures
- Threat intelligence lookups
- GeoIP data
- Parent process chain

## Event Volume

Typical event volumes vary by:
- System activity level
- Exfil rule configuration
- Event types enabled
- Workload characteristics

## Common Use Cases

### Threat Hunting
Query historical events to find indicators of compromise.

### Incident Response
Investigate security incidents using event timeline.

### Compliance
Monitor and audit system activity for compliance requirements.

### Detection Engineering
Build Detection & Response rules based on event patterns.

## Performance Impact

LimaCharlie endpoint agents are designed for minimal performance impact:
- Kernel-level event collection
- Efficient filtering at source
- Cloud-based processing
- Adaptive sampling

## Best Practices

1. **Use exfil rules** to control event volume
2. **Enable relevant events** for your use cases
3. **Leverage enrichment** (hashes, signatures)
4. **Monitor sensor performance** metrics
5. **Archive critical events** before retention expiration

For detailed event schemas, see the Event Schemas reference.

---

# Platform Events Overview

Platform events are generated by LimaCharlie cloud infrastructure rather than endpoint agents. They capture system-level activities, infrastructure changes, and platform operations.

## Platform Event Categories

### Audit Events
Track administrative actions and configuration changes:
- User management (create, modify, delete)
- API key operations
- Organization settings changes
- Detection rule modifications
- Service configuration updates

### Service Events
Monitor platform service status:
- Service health changes
- Integration status
- Webhook delivery status
- Processing errors
- Queue metrics

### Billing Events
Track usage and billing activities:
- Subscription changes
- Usage thresholds
- Invoice generation
- Payment events

### Integration Events
Events from third-party integrations:
- External service callbacks
- Webhook deliveries
- API integrations
- Data exports

### Infrastructure Events
Platform infrastructure changes:
- Sensor registration
- Sensor decommissioning
- Tag modifications
- Installer creation

## Platform Event Structure

Platform events follow the standard event schema with routing information specific to the platform context:

```json
{
  "routing": {
    "oid": "organization_id",
    "event_source": "platform"
  },
  "event_type": "PLATFORM_EVENT_TYPE",
  "event_time": 1234567890,
  "event": {
    // Platform-specific fields
  }
}
```

## Common Platform Events

### USER_CREATED
```json
{
  "event_type": "USER_CREATED",
  "event": {
    "user_email": "user@example.com",
    "user_role": "analyst",
    "created_by": "admin@example.com"
  }
}
```

### API_KEY_GENERATED
```json
{
  "event_type": "API_KEY_GENERATED",
  "event": {
    "key_name": "automation_key",
    "permissions": ["read", "write"],
    "created_by": "admin@example.com"
  }
}
```

### RULE_MODIFIED
```json
{
  "event_type": "RULE_MODIFIED",
  "event": {
    "rule_name": "detect_malware",
    "changes": ["enabled", "action"],
    "modified_by": "analyst@example.com"
  }
}
```

### WEBHOOK_DELIVERY_FAILED
```json
{
  "event_type": "WEBHOOK_DELIVERY_FAILED",
  "event": {
    "webhook_url": "https://example.com/webhook",
    "error": "Connection timeout",
    "retry_count": 3
  }
}
```

## Accessing Platform Events

Platform events are available through:

### REST API
Query platform events using the events API with platform-specific filters.

### Web Interface
View platform events in the audit log section.

### Detection & Response
Create D&R rules that trigger on platform events.

### Webhooks
Forward platform events to external systems.

## Platform Event Retention

Platform events follow organizational retention policies:
- Audit events: Typically retained longer for compliance
- Service events: Standard retention
- Integration events: Standard retention

## Use Cases

### Security Auditing
Monitor administrative actions and configuration changes for security compliance.

### Operations Monitoring
Track service health and integration status for operational awareness.

### Compliance Reporting
Generate audit trails of user actions and system changes.

### Automation
Trigger automated workflows based on platform events.

## Best Practices

1. **Enable audit logging** for compliance requirements
2. **Monitor webhook failures** for integration health
3. **Set up alerts** for critical platform events
4. **Review audit logs** regularly
5. **Archive important events** for long-term compliance

For event schemas and field definitions, see the Event Schemas reference.