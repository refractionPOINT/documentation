---
name: get-historic-detections
description: Retrieve historical security detections and alerts for the organization within a time range. Filter by sensor ID or detection category. Use for security incident review, threat analysis, detection rule effectiveness evaluation, compliance reporting, and tracking detected threats over time.
allowed-tools: mcp__limacharlie__lc_api_call, Read
---

# Get Historic Detections

Retrieve historical security detections and alerts for your organization within a specified time range.

## When to Use

Use this skill when the user needs to:
- Review all detections in a time period
- Analyze threat activity over time
- Filter detections by sensor or category
- Generate security reports
- Evaluate detection rule effectiveness
- Track IOC appearances
- Investigate alert trends
- Prepare for incident response

Common scenarios:
- "Show me all detections from the last 24 hours"
- "What alerts triggered on sensor xyz-123 this week?"
- "List all malware detections in the last month"
- "Get detections for category 'suspicious_process'"
- "Show me threat activity trends for the last 7 days"

## What This Skill Does

This skill retrieves all security detections generated by your D&R rules within a specified time range, with optional filtering by sensor ID or detection category.

## Required Information

Before calling this skill, gather:
- **oid**: Organization ID (required)
- **start**: Start timestamp in Unix epoch seconds
- **end**: End timestamp in Unix epoch seconds

Optional parameters:
- **sid**: Sensor ID to filter detections for specific sensor
- **cat**: Detection category to filter by (e.g., "malware", "suspicious_process")
- **limit**: Maximum number of detections to return

## How to Use

### Step 1: Validate Parameters

Ensure you have:
1. Valid organization ID (oid)
2. Start and end timestamps (Unix epoch seconds)
3. Time range is reasonable
4. Optional filters are properly formatted

### Step 2: Call the API

Use the `lc_api_call` MCP tool:

```
mcp__limacharlie__lc_api_call(
  oid="c7e8f940-1234-5678-abcd-1234567890ab",
  endpoint="api",
  method="GET",
  path="/insight/c7e8f940-1234-5678-abcd-1234567890ab/detections",
  query_params={
    "start": 1705761234,
    "end": 1705847634,
    "sid": "xyz-sensor-id",
    "cat": "suspicious_process",
    "limit": 100,
    "cursor": "-"
  }
)
```

**API Details:**
- Endpoint: `api`
- Method: `GET`
- Path: `/insight/{oid}/detections`
- Query parameters:
  - `start`: Unix epoch timestamp in seconds (required)
  - `end`: Unix epoch timestamp in seconds (required)
  - `sid`: Sensor ID filter (optional)
  - `cat`: Detection category filter (optional)
  - `limit`: Max results (optional)
  - `cursor`: Pagination cursor (optional, use "-" for first page)

**Note:** The SDK method `org.HistoricalDetections()` handles pagination automatically.

### Step 3: Handle the Response

The API returns:
```json
{
  "status_code": 200,
  "body": {
    "detects": [
      {
        "detect_id": "detect-uuid-123",
        "cat": "suspicious_process",
        "detect": {
          "event": {
            "TIMESTAMP": 1705761234567,
            "COMMAND_LINE": "powershell.exe -encodedCommand ...",
            "FILE_PATH": "C:\\Windows\\System32\\WindowsPowerShell\\..."
          },
          "routing": {
            "sid": "xyz-123",
            "hostname": "SERVER01"
          }
        },
        "detect_mtd": {
          "rule_name": "Encoded PowerShell Command",
          "author": "security-team",
          "severity": 8
        }
      }
    ],
    "next_cursor": "cursor-token-or-empty"
  }
}
```

**Success (200):**
- Returns array of detections with full event context
- Each detection includes category, event data, routing, and metadata
- Pagination supported via cursor tokens

**Common Errors:**
- **400 Bad Request**: Invalid parameters
- **403 Forbidden**: Insufficient permissions
- **500 Server Error**: Service issue, retry

### Step 4: Format the Response

Present results to user:
- Group by severity or category
- Show detection count
- Display timestamps, affected hosts, and rule names
- Highlight high-severity detections
- Provide drill-down links to full details

**Example output:**
```
Detections from 2024-01-20 14:00 to 2024-01-21 14:00
Total: 15 detections

HIGH SEVERITY (5):
[14:22:15] SERVER01 - Encoded PowerShell Command
  Category: suspicious_process
  Rule: Encoded PowerShell Command (severity 8)
  Command: powershell.exe -encodedCommand...

MEDIUM SEVERITY (8):
[14:45:30] WORKSTATION-05 - Suspicious Network Connection
  Category: network_threat
  Rule: Connection to Known Bad IP
  Destination: 203.0.113.50:443

LOW SEVERITY (2):
...
```

## Example Usage

### Example 1: Recent detections

User: "Show me all detections from the last 24 hours"

```
mcp__limacharlie__lc_api_call(
  oid="c7e8f940-1234-5678-abcd-1234567890ab",
  endpoint="api",
  method="GET",
  path="/insight/c7e8f940-1234-5678-abcd-1234567890ab/detections",
  query_params={
    "start": 1705761234,
    "end": 1705847634
  }
)
```

### Example 2: Sensor-specific detections

User: "What alerts triggered on sensor xyz-123 this week?"

Add `sid` filter to query parameters.

## Additional Notes

- Detections are generated by D&R rules
- Categories are defined by rule authors
- Severity typically ranges 1-10 (low to critical)
- Use pagination for large result sets
- Combine with LCQL for complex analysis
- Detection metadata includes rule name, author, tags

## Reference

See [CALLING_API.md](../../CALLING_API.md) for details on using `lc_api_call`.

SDK: `../go-limacharlie/limacharlie/organization.go`
MCP: `../lc-mcp-server/internal/tools/historical/historical.go`
